<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      .container {
        width: 615px;
        height: 375px;
        border: 1px solid #ccc;
        margin: 100px auto;
        position: relative;
      }
      .content div {
        width: 15px;
        height: 15px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        background-color: red;
        position: absolute;
        top: 0;
        left: 0;
      }
      li {
        width: 15px;
        height: 15px;
        float: left;
      }
      .food {
        width: 15px;
        height: 15px;
        background-color: green;
        position: absolute;
      }
      /* li:nth-child(2n) {
        background-color: pink;
      } */
    </style>
  </head>
  <body>
    <div class="container">
      <ul></ul>
      <div class="content"></div>
    </div>

    <script>
      let box = document.querySelector('.container');
      let ul = document.querySelector('ul');
      let ctn = document.querySelector('.content');
      // 创建网格
      let obj = {
        size: 15,
        x: 41,
        y: 25,
      };
      ul.style.width = obj.size * obj.x + 'px';
      ul.style.height = obj.size * obj.y + 'px';
      for (let i = 0; i < obj.x * obj.y; i++) {
        let li = document.createElement('li');
        ul.appendChild(li);
      }
      let lis = document.querySelectorAll('li');
      // 动态创建蛇
      let snake = document.createElement('div');
      ctn.appendChild(snake);
      let snakes = Array.from(ctn.querySelectorAll('div'));
      // 创建食物
      Food();
      // 控制蛇移动
      let keyData = {
        speed: 200,
        code: 39,
      };
      document.addEventListener('keydown', function (e) {
        switch (e.keyCode) {
          case 37:
            keyData.code = 37;
            break;
          case 38:
            keyData.code = 38;
            break;
          case 39:
            keyData.code = 39;
            break;
          case 40:
            keyData.code = 40;
            break;
        }
      });
      let timer = setInterval(function () {
        //  判断是否吃到食物
        let food = document.querySelector('.food');
        // if (
        //   snakes[0].offsetLeft == food.offsetLeft &&
        //   snakes[0].offsetTop == food.offsetTop
        // ) {
        //   food.style.backgroundColor = 'red';
        //   snakes.push(food);
        //   ctn.appendChild(food);
        //   food.className = '';
        //   Food();
        // } else {
        //   food.style.backgroundColor = 'green';
        // }
        if (move(snakes[0], food)) {
          food.style.backgroundColor = 'red';
          snakes.push(food);
          ctn.appendChild(food);
          food.className = '';
          Food();
        } else {
          food.style.backgroundColor = 'green';
        }
        for (let i = snakes.length - 1; i > 0; i--) {
          snakes[i].style.left = snakes[i - 1].offsetLeft + 'px';
          snakes[i].style.top = snakes[i - 1].offsetTop + 'px';
        }
        // 控制方向
        switch (keyData.code) {
          case 37:
            snakes[0].style.left = snakes[0].offsetLeft - obj.size + 'px';
            break;
          case 38:
            snakes[0].style.top = snakes[0].offsetTop - obj.size + 'px';
            break;
          case 39:
            snakes[0].style.left = snakes[0].offsetLeft + obj.size + 'px';
            break;
          case 40:
            snakes[0].style.top = snakes[0].offsetTop + obj.size + 'px';
            break;
        }
        // // 判断是否结束
        if (
          snakes[0].offsetLeft < 0 ||
          snakes[0].offsetLeft > ul.offsetWidth - snakes[0].offsetWidth ||
          snakes[0].offsetTop < 0 ||
          snakes[0].offsetTop > ul.offsetHeight - snakes[0].offsetWidth
        ) {
          alert('游戏结束！');
          clearInterval(timer);
        }
        if (snakes.length > 1) {
          for (let i = 1; i < snakes.length; i++) {
            if (
              snakes[0].offsetLeft == snakes[i].offsetLeft &&
              snakes[0].offsetTop == snakes[i].offsetTop
            ) {
              alert('游戏结束！');
              clearInterval(timer);
            }
          }
        }
      }, keyData.speed);

      // 判断是否吃到食物
      function move(el1, el2) {
        let r1 = el1.offsetLeft + el1.offsetWidth;
        b1 = el1.offsetTop + el1.offsetWidth;
        l1 = el1.offsetLeft;
        t1 = el1.offsetTop;
        let l2 = el2.offsetLeft;
        t2 = el2.offsetTop;
        r2 = el2.offsetLeft + el2.offsetWidth;
        b2 = el2.offsetTop + el2.offsetWidth;
        if (r1 < l2 || b1 < t2 || l1 > r2 || t1 > b2) {
          return false;
        } else {
          return true;
        }
      }
      // 创建食物
      function Food() {
        let food = document.createElement('div');
        food.className = 'food';
        box.appendChild(food);
        // 判断食物位置是否与蛇重叠
        let foodX = RandomNum(0, obj.x - 1) * obj.size;
        let foodY = RandomNum(0, obj.y - 1) * obj.size;
        for (let i = 0; i < snakes.length; i++) {
          if (snakes[i].offsetLeft == foodX && snakes[i].offsetTop == foodY) {
            foodX = RandomNum(0, obj.x - 1) * obj.size;
            foodY = RandomNum(0, obj.y - 1) * obj.size;
            n = -1;
          }
        }
        food.style.left = foodX + 'px';
        food.style.top = foodY + 'px';
      }
      // 生成随机数
      function RandomNum(min, max) {
        return min + Math.floor((max - min) * Math.random());
      }
    </script>
  </body>
</html>
