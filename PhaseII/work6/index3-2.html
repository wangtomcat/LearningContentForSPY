<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      .container {
        width: 610px;
        height: 390px;
        border: 1px solid #ccc;
        margin: 100px auto;
        position: relative;
      }
      .snake {
        width: 15px;
        height: 15px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        background-color: red;
        position: absolute;
        top: 0;
        left: 0;
      }
      .food {
        width: 15px;
        height: 15px;
        background-color: green;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="snake"></div>
    </div>

    <script>
      let box = document.querySelector('.container');
      let snakes = document.getElementsByClassName('snake');
      let t = false,
        b = false,
        l = false,
        r = true;
      let flagOver = true;
      // 创建食物
      RandomFood();
      // 控制方向
      document.addEventListener('keydown', function (e) {
        switch (e.keyCode) {
          case 37:
            if (r) {
              t = false;
              b = false;
              l = false;
              r = true;
            } else {
              t = false;
              b = false;
              l = true;
              r = false;
            }
            break;
          case 38:
            if (b) {
              t = false;
              b = true;
              l = false;
              r = false;
            } else {
              t = true;
              b = false;
              l = false;
              r = false;
            }
            break;
          case 39:
            if (l) {
              t = false;
              b = false;
              l = true;
              r = false;
            } else {
              t = false;
              b = false;
              l = false;
              r = true;
            }
            break;
          case 40:
            if (t) {
              t = true;
              b = false;
              l = false;
              r = false;
            } else {
              t = false;
              b = true;
              l = false;
              r = false;
            }
            break;
        }
      });
      let timer = setInterval(function () {
        let snakeN = document.createElement('div');
        snakeN.className = 'snake';
        let snakeN_t = snakes[0].offsetTop,
          snakeN_l = snakes[0].offsetLeft;
        if (l) {
          snakeN_l -= 15;
          if (Food()) {
            eatFood(snakeN, snakeN_l, snakeN_t);
          } else {
            move(snakeN, snakeN_l, snakeN_t);
          }
        }
        if (r) {
          snakeN_l += 15;
          if (Food()) {
            eatFood(snakeN, snakeN_l, snakeN_t);
          } else {
            move(snakeN, snakeN_l, snakeN_t);
          }
        }
        if (t) {
          snakeN_t -= 15;
          if (Food()) {
            eatFood(snakeN, snakeN_l, snakeN_t);
          } else {
            move(snakeN, snakeN_l, snakeN_t);
          }
        }
        if (b) {
          snakeN_t += 15;
          if (Food()) {
            eatFood(snakeN, snakeN_l, snakeN_t);
          } else {
            move(snakeN, snakeN_l, snakeN_t);
          }
        }
      }, 200);

      // 判断是否吃到食物
      function Food() {
        let snake_t = snakes[0].offsetTop,
          snake_l = snakes[0].offsetLeft,
          snake_r = snakes[0].offsetLeft + snakes[0].offsetWidth,
          snake_b = snakes[0].offsetTop + snakes[0].offsetWidth;
        let food = document.querySelector('.food');
        let food_t = food.offsetTop,
          food_l = food.offsetLeft,
          food_r = food.offsetLeft + food.offsetWidth,
          food_b = food.offsetTop + food.offsetWidth;
        let leftEat, rightEat, topEat, bottomEat;
        if (
          l &&
          snake_l <= food_r &&
          !(snake_b <= food_t || snake_t >= food_b || snake_r <= food_l)
        ) {
          leftEat = true;
        } else {
          leftEat = false;
        }
        if (
          t &&
          snake_t <= food_b &&
          !(snake_b <= food_t || snake_r <= food_l || snake_l >= food_r)
        ) {
          topEat = true;
        } else {
          topEat = false;
        }
        if (
          r &&
          snake_r >= food_l &&
          !(snake_b <= food_t || snake_l >= food_r || snake_t >= food_b)
        ) {
          rightEat = true;
        } else {
          rightEat = false;
        }
        if (
          b &&
          snake_b >= food_t &&
          !(snake_r <= food_l || snake_l >= food_r || snake_t >= food_b)
        ) {
          bottomEat = true;
        } else {
          bottomEat = false;
        }
        return leftEat || rightEat || topEat || bottomEat;
      }

      // 判断是否结束游戏
      function isOver(left, top) {
        if (left < 0 || left >= 610 || top < 0 || top >= 390) {
          clearInterval(timer);
          alert('游戏结束！');
          flagOver = false;
        }
        for (let i = 1; i < snakes.length; i++) {
          if (
            snakes[0].offsetLeft == snakes[i].offsetLeft &&
            snakes[0].offsetTop == snakes[i].offsetTop
          ) {
            clearInterval(timer);
            alert('游戏结束！');
            flagOver = false;
          }
        }
      }
      // 吃食物
      function eatFood(newSnake, left, top) {
        flagOver = true;
        isOver(left, top);
        if (flagOver) {
          newSnake.style.top = top + 'px';
          newSnake.style.left = left + 'px';
          box.insertBefore(newSnake, snakes[0]);
          let food = document.querySelector('.food');
          box.removeChild(food);
          RandomFood();
        }
      }
      // 移动
      function move(newSnake, left, top) {
        isOver(left, top);
        if (!flagOver) return;
        box.removeChild(snakes[snakes.length - 1]);
        newSnake.style.top = top + 'px';
        newSnake.style.left = left + 'px';
        box.insertBefore(newSnake, snakes[0]);
      }
      // 创建食物
      function RandomFood() {
        let food = document.createElement('div');
        food.className = 'food';
        box.appendChild(food);
        // 判断食物位置是否与蛇重叠
        let foodX = RandomNum(0, 40) * 15;
        let foodY = RandomNum(0, 25) * 15;
        for (let i = 0; i < snakes.length; i++) {
          if (snakes[i].offsetLeft == foodX && snakes[i].offsetTop == foodY) {
            let foodX = RandomNum(0, 40) * 15;
            let foodY = RandomNum(0, 25) * 15;
            n = -1;
          }
        }
        food.style.left = foodX + 'px';
        food.style.top = foodY + 'px';
      }
      // 生成随机数;
      function RandomNum(min, max) {
        return min + Math.floor((max - min) * Math.random());
      }
    </script>
  </body>
</html>
