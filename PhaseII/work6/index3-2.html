<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      .container {
        width: 615px;
        height: 375px;
        border: 1px solid #ccc;
        margin: 100px auto;
        position: relative;
      }
      .content div {
        width: 15px;
        height: 15px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        background-color: red;
        position: absolute;
        top: 0;
        left: 0;
      }
      li {
        width: 15px;
        height: 15px;
        float: left;
      }
      .food {
        width: 15px;
        height: 15px;
        background-color: green;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <ul></ul>
      <div class="content"></div>
    </div>

    <script>
      let box = document.querySelector('.container');
      let ul = document.querySelector('ul');
      let ctn = document.querySelector('.content');
      // 动态创建蛇
      let snake = document.createElement('div');
      ctn.appendChild(snake);
      let snakes = Array.from(ctn.querySelectorAll('div'));
      // 创建网格
      let obj = {
        size: 15,
        x: 41,
        y: 25,
      };
      ul.style.width = obj.size * obj.x + 'px';
      ul.style.height = obj.size * obj.y + 'px';
      for (let i = 0; i < obj.x * obj.y; i++) {
        let li = document.createElement('li');
        ul.appendChild(li);
      }
      // 创建食物
      RandomFood();
      // 控制蛇移动
      let keyData = {
        speed: 200,
        code: 39,
      };
      document.addEventListener('keydown', function (e) {
        switch (e.keyCode) {
          case 37:
            if (keyData.code != 39) {
              keyData.code = 37;
            }
            break;
          case 38:
            if (keyData.code != 40) {
              keyData.code = 38;
            }
            break;
          case 39:
            if (keyData.code != 37) {
              keyData.code = 39;
            }
            break;
          case 40:
            if (keyData.code != 38) {
              keyData.code = 40;
            }
            break;
        }
      });
      let timer = setInterval(function () {
        //  判断是否吃到食物
        Food(document.querySelector('.food'));
        // 给蛇的身体赋值
        newSnakes();
        // 控制方向
        switch (keyData.code) {
          case 37:
            snakes[0].style.left = snakes[0].offsetLeft - obj.size + 'px';
            break;
          case 38:
            snakes[0].style.top = snakes[0].offsetTop - obj.size + 'px';
            break;
          case 39:
            snakes[0].style.left = snakes[0].offsetLeft + obj.size + 'px';
            break;
          case 40:
            snakes[0].style.top = snakes[0].offsetTop + obj.size + 'px';
            break;
        }
        // 判断是否结束
        isOver(snakes, ul);
      }, keyData.speed);

      // 创建食物
      function RandomFood() {
        let food = document.createElement('div');
        food.className = 'food';
        box.appendChild(food);
        // 判断食物位置是否与蛇重叠
        let foodX = RandomNum(0, obj.x - 1) * obj.size;
        let foodY = RandomNum(0, obj.y - 1) * obj.size;
        for (let i = 0; i < snakes.length; i++) {
          if (snakes[i].offsetLeft == foodX && snakes[i].offsetTop == foodY) {
            foodX = RandomNum(0, obj.x - 1) * obj.size;
            foodY = RandomNum(0, obj.y - 1) * obj.size;
            n = -1;
          }
        }
        food.style.left = foodX + 'px';
        food.style.top = foodY + 'px';
      }

      // 判断是否吃到食物
      function Food(food) {
        let snake_w = snakes[0].offsetWidth;
        let snake_t = snakes[0].offsetTop;
        let snake_l = snakes[0].offsetLeft;
        if (
          snake_l == food.offsetLeft &&
          (snake_t + snake_w == food.offsetTop ||
            snake_t - snake_w == food.offsetTop) &&
          (keyData.code == 38 || keyData.code == 40)
        ) {
          eatFood(food);
        } else if (
          snake_t == food.offsetTop &&
          (snake_l + snake_w == food.offsetLeft ||
            snake_l - snake_w == food.offsetLeft) &&
          (keyData.code == 37 || keyData.code == 39)
        ) {
          eatFood(food);
        } else {
          food.style.backgroundColor = 'green';
        }
      }

      // 判断是否结束游戏
      function isOver(el1, el2) {
        // 撞到四周
        if (el1[0].offsetLeft < 0) {
          el1[0].style.left = 0;
          over();
        } else if (el1[0].offsetLeft > el2.offsetWidth - el1[0].offsetWidth) {
          el1[0].style.left = el2.offsetWidth - el1[0].offsetWidth + 'px';
          over();
        } else if (el1[0].offsetTop < 0) {
          el1[0].style.top = 0;
          over();
        } else if (el1[0].offsetTop > el2.offsetHeight - el1[0].offsetWidth) {
          el1[0].style.top = el2.offsetHeight - el1[0].offsetWidth + 'px';
          over();
        } else if (el1.length > 1) {
          for (let i = 1; i < el1.length; i++) {
            if (
              el1[0].offsetLeft == el1[i].offsetLeft &&
              el1[0].offsetTop == el1[i].offsetTop
            ) {
              over();
            }
          }
        }
       
      }

      // 吃食物
      function eatFood(food) {
        food.style.backgroundColor = 'red';
        snakes.push(food);
        ctn.appendChild(food);
        food.classList.remove('food');
        RandomFood();
      }
      // 给蛇的身体赋值
     function newSnakes() {
        for (let i = snakes.length - 1; i > 0; i--) {
          snakes[i].style.left = snakes[i - 1].offsetLeft + 'px';
          snakes[i].style.top = snakes[i - 1].offsetTop + 'px';
        }
      };

      // 结束游戏
      function over() {
        alert('游戏结束！');
        clearInterval(timer);
      }
      // 生成随机数
      function RandomNum(min, max) {
        return min + Math.floor((max - min) * Math.random());
      }
    </script>
  </body>
</html>
